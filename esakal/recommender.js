var CryptoJS;function generateSignature(t,e){var n=t.replace(e.domain,""),i=(new Date).toUTCString(),r=e.contentType.concat(",",n,",",i);return[CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA1(r,e.secret)),i]}function convertToLocalDate(t){return new Date(t).toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"}).split(" ").join(" ")}function formatData(t,e){const n={};return n.items=t[0].recommendations,n.items.map((t,n)=>{t.Timestamp=convertToLocalDate(t.Timestamp),t.ImageUrl?t.ImageUrl=e.imgDomain+t.ImageUrl:t.ImageUrl=e.fallBackImageUrl,t.ArticleNumber=n+1}),{items:[{values:n.items}]}}async function fetchRecommendations(){const t=await AMP.getState("wru-widget-config"),e=JSON.parse(t),n=document.querySelector(".wru-widget").id.replace(e.widgetPrefix,""),i=`${e.domain}/${e.merchantId}?cid=${n}&st=${e.strategy}&offset=0&source=true&count=${e.articleLimit}`;var r=generateSignature(i,e);const a={accept:e.contentType,"content-type":e.contentType,authorization:`Authorization me:${r[0]}`,dateused:r[1]};try{return fetch(i,{method:"GET",headers:a,credentials:"include"}).then(t=>t.json()).then(t=>formatData(t,e))}catch(t){throw t}}CryptoJS=CryptoJS||function(t,e){var n={},i=n.lib={},r=function(){},a=i.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=a.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!==e?e:4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var r=0;r<t;r++)e[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<t;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;i<e;i+=4)n.push(4294967296*t.random()|0);return new o.init(n,e)}}),s=n.enc={},c=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;i<t;i++){var r=e[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new o.init(n,e/2)}},h=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;i<t;i++)n.push(String.fromCharCode(e[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new o.init(n,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(h.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return h.parse(unescape(encodeURIComponent(t)))}},f=i.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a);if(e=(s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0))*a,r=t.min(4*e,r),e){for(var c=0;c<e;c+=a)this._doProcessBlock(i,c);c=i.splice(0,e),n.sigBytes-=r}return new o.init(c,r)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=f.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new l.HMAC.init(t,n).finalize(e)}}});var l=n.algo={};return n}(Math),function(){var t=CryptoJS,e=t.lib,n=e.WordArray,i=e.Hasher,r=[];e=t.algo.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],a=n[1],o=n[2],s=n[3],c=n[4],h=0;80>h;h++){if(16>h)r[h]=0|t[e+h];else{var u=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=u<<1|u>>>31}u=(i<<5|i>>>27)+c+r[h],u=20>h?u+(1518500249+(a&o|~a&s)):40>h?u+(1859775393+(a^o^s)):60>h?u+((a&o|a&s|o&s)-1894007588):u+((a^o^s)-899497514),c=s,s=o,o=a<<30|a>>>2,a=i,i=u}n[0]=n[0]+i|0,n[1]=n[1]+a|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+c|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[14+(i+64>>>9<<4)]=Math.floor(n/4294967296),e[15+(i+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}}),t.SHA1=i._createHelper(e),t.HmacSHA1=i._createHmacHelper(e)}(),function(){var t=CryptoJS,e=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,"string"==typeof n&&(n=e.parse(n));var i=t.blockSize,r=4*i;n.sigBytes>r&&(n=t.finalize(n)),n.clamp();for(var a=this._oKey=n.clone(),o=this._iKey=n.clone(),s=a.words,c=o.words,h=0;h<i;h++)s[h]^=1549556828,c[h]^=909522486;a.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}})}(),function(){var t=CryptoJS,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,i=this._map;t.clamp();for(var r=[],a=0;a<n;a+=3)for(var o=(e[a>>>2]>>>24-a%4*8&255)<<16|(e[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|e[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<n;s++)r.push(i.charAt(o>>>6*(3-s)&63));var c=i.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(t){var n=t.length,i=this._map,r=i.charAt(64);if(r){var a=t.indexOf(r);-1!==a&&(n=a)}for(var o=[],s=0,c=0;c<n;c++)if(c%4){var h=i.indexOf(t.charAt(c-1))<<c%4*2,u=i.indexOf(t.charAt(c))>>>6-c%4*2;o[s>>>2]|=(h|u)<<24-s%4*8,s++}return e.create(o,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),exportFunction("fetchData",fetchRecommendations);
